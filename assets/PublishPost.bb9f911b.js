import{E as k,_ as V,d as z,u as E,b as w,r as i,c as p,e as s,w as L,v as U,t as P,z as C,G as f,o as m}from"./index.60eeee1d.js";function S(e){const t=new FormData;return t.append("image",e.file),t.append("title",e.title),t.append("description",e.content),k({url:"/image",method:"POST",headers:{"Content-Type":"multipart/form-data"},data:t})}const $=z({name:"PublishPost",components:{},setup(){const e=E(),t={noContent:"\u6C92\u6709\u8CBC\u6587\u5167\u5BB9\uFF0C\u8ACB\u586B\u5BEB",imageSizeError:"\u5716\u7247\u6A94\u6848\u904E\u5927\uFF0C\u50C5\u9650 1mb \u4EE5\u4E0B\u6A94\u6848",imageTypeError:"\u5716\u7247\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650 JPG\u3001PNG \u5716\u7247"};let a=w({}),l=w({name:"",thumbnail:null,size:null,unit:"KB"}),g=i(""),d=i(""),o=i(null),c=i(!1),v=i(""),h=i(!1),_=i("");const I=n=>{a=n.target.files[0],l.name=a.name,l.thumbnail=window.URL.createObjectURL(a),l.size=Math.floor(a.size*.001),g.value=l.name,o.value=URL.createObjectURL(a),l.size>1e3?(c.value=!0,v.value=t.imageSizeError):c.value=!1};let b=async()=>{var n;try{const r={file:a,title:g.value,description:d.value},u=await S(r);return(n=u==null?void 0:u.data)==null?void 0:n.imageUrl}catch(r){console.log(r)}};return{errorImageMessageVised:c,errorImageMessage:v,errorContentMessageVised:h,errorContentMessage:_,content:d,preViewImage:o,showFile:I,submitPost:async()=>{var n;try{if(e.dispatch("ui/toggleLoading",!0),h.value=!1,d.value==="")return h.value=!0,_.value=t.noContent,!1;if(c.value)return!1;let r="";a!=null&&a.size&&(r=await b());const u=(n=e.getters["user/userInfo"])==null?void 0:n.id,{status:M,data:y}=await e.dispatch("post/addPost",{userId:u,content:d.value.trim(),image:r});M==="success"&&y.author?f.push({path:`/personal/${y.author}`}):f.push({path:"/home"})}catch(r){console.log("create post error",r),f.push({path:"/home"})}finally{e.dispatch("ui/toggleLoading",!1)}},submitImage:b}}}),B=s("div",{class:"block-title"}," \u5F35\u8CBC\u52D5\u614B ",-1),D={class:"draft-post"},F={class:"draft-post__post"},T=s("p",{class:"draft-post__post__label"},"\u8CBC\u6587\u5167\u5BB9",-1),j={class:"draft-post__textarea"},G={style:{"margin-top":"16px"}},N=s("label",{for:"upload",class:"text-btn black"},"\u4E0A\u50B3\u5716\u7247",-1),O=["src"],R={key:1,class:"draft-post__img"},x={key:2,class:"error-message"},J={key:3,class:"error-message"},K={style:{"max-width":"323px",margin:"0 auto"}};function q(e,t,a,l,g,d){return m(),p("div",null,[B,s("div",D,[s("div",F,[T,s("div",j,[L(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.content=o),type:"text",name:"nickname",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9\u7A31"},null,512),[[U,e.content]])])]),s("div",G,[N,s("input",{id:"upload",style:{visibility:"hidden"},type:"file",accept:"image/png, image/gif, image/jpeg",onChange:t[1]||(t[1]=(...o)=>e.showFile&&e.showFile(...o))},null,32)]),e.preViewImage?(m(),p("img",{key:0,class:"draft-post__img",style:{"margin-top":"16px"},src:e.preViewImage},null,8,O)):(m(),p("div",R)),e.errorImageMessageVised?(m(),p("p",x,P(e.errorImageMessage),1)):C("",!0),e.errorContentMessageVised?(m(),p("p",J,P(e.errorContentMessage),1)):C("",!0),s("div",K,[s("button",{style:{"margin-top":"32px"},class:"btn secondary",onClick:t[2]||(t[2]=(...o)=>e.submitPost&&e.submitPost(...o))}," \u9001\u51FA\u8CBC\u6587 ")])])])}var Q=V($,[["render",q]]);export{Q as default};

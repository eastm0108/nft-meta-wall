import{E as C,_ as V,d as z,u as L,b as P,r as i,c,e as a,w as E,v as U,t as k,z as I,G as v,o as m}from"./index.f7611589.js";const $="https://api.imgur.com/3/image";function B(e){const t=new FormData;return t.append("image",e.file),t.append("title",e.title),t.append("description",e.content),t.append("album","PFOcaDX"),C({method:"post",url:$,headers:{Authorization:"Bearer 813beb0e985f27f119d274c110763509ca52f161"},data:t})}const D=z({name:"PublishPost",components:{},setup(){const e=L(),t={noContent:"\u6C92\u6709\u8CBC\u6587\u5167\u5BB9\uFF0C\u8ACB\u586B\u5BEB",imageSizeError:"\u5716\u7247\u6A94\u6848\u904E\u5927\uFF0C\u50C5\u9650 1mb \u4EE5\u4E0B\u6A94\u6848",imageTypeError:"\u5716\u7247\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650 JPG\u3001PNG \u5716\u7247"};let s=P({}),l=P({name:"",thumbnail:null,size:null,unit:"KB"}),h=i(""),d=i(""),o=i(null),g=i(!1),_=i(""),f=i(!1),b=i("");const M=r=>{s=r.target.files[0],l.name=s.name,l.thumbnail=window.URL.createObjectURL(s),l.size=Math.floor(s.size*.001),h.value=l.name,o.value=URL.createObjectURL(s),l.size>1e3?(g.value=!0,_.value=t.imageSizeError):g.value=!1};let y=async()=>{var r,n;try{const u={file:s,title:h.value,description:d.value},p=await B(u);return(n=(r=p==null?void 0:p.data)==null?void 0:r.data)==null?void 0:n.link}catch(u){console.log(u)}};return{errorImageMessageVised:g,errorImageMessage:_,errorContentMessageVised:f,errorContentMessage:b,content:d,preViewImage:o,showFile:M,submitPost:async()=>{var r;try{if(e.dispatch("ui/toggleLoading",!0),f.value=!1,d.value==="")return f.value=!0,b.value=t.noContent,!1;if(g.value)return!1;let n="";s!=null&&s.size&&(n=await y());const u=(r=e.getters["user/userInfo"])==null?void 0:r.id,{status:p,data:w}=await e.dispatch("post/addPost",{userId:u,content:d.value.trim(),image:n});p==="success"&&w.author?v.push({path:`/personal/${w.author}`}):v.push({path:"/home"})}catch(n){console.log("create post error",n),v.push({path:"/home"})}finally{e.dispatch("ui/toggleLoading",!1)}},submitImage:y}}}),F=a("div",{class:"block-title"}," \u5F35\u8CBC\u52D5\u614B ",-1),R={class:"draft-post"},S={class:"draft-post__post"},j=a("p",{class:"draft-post__post__label"},"\u8CBC\u6587\u5167\u5BB9",-1),G={class:"draft-post__textarea"},N={style:{"margin-top":"16px"}},O=a("label",{for:"upload",class:"text-btn black"},"\u4E0A\u50B3\u5716\u7247",-1),x=["src"],T={key:1,class:"draft-post__img"},A={key:2,class:"error-message"},J={key:3,class:"error-message"},K={style:{"max-width":"323px",margin:"0 auto"}};function X(e,t,s,l,h,d){return m(),c("div",null,[F,a("div",R,[a("div",S,[j,a("div",G,[E(a("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.content=o),type:"text",name:"nickname",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9\u7A31"},null,512),[[U,e.content]])])]),a("div",N,[O,a("input",{id:"upload",style:{visibility:"hidden"},type:"file",accept:"image/png, image/gif, image/jpeg",onChange:t[1]||(t[1]=(...o)=>e.showFile&&e.showFile(...o))},null,32)]),e.preViewImage?(m(),c("img",{key:0,class:"draft-post__img",style:{"margin-top":"16px"},src:e.preViewImage},null,8,x)):(m(),c("div",T)),e.errorImageMessageVised?(m(),c("p",A,k(e.errorImageMessage),1)):I("",!0),e.errorContentMessageVised?(m(),c("p",J,k(e.errorContentMessage),1)):I("",!0),a("div",K,[a("button",{style:{"margin-top":"32px"},class:"btn secondary",onClick:t[2]||(t[2]=(...o)=>e.submitPost&&e.submitPost(...o))}," \u9001\u51FA\u8CBC\u6587 ")])])])}var Q=V(D,[["render",X]]);export{Q as default};
